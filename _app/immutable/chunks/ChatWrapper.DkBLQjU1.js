import{s as U,f as x,o as ae,d as re,e as le,n as H,r as ie}from"./scheduler.DbuCXXLn.js";import{S as N,i as T,w as O,n as C,t as _,z as V,b as p,x as B,k as h,e as w,g as y,h as M,q as d,B as K,D as j,C as $,f as ee,j as te,o as v,p as se,c as D,a as I,m as S,d as E,s as A,l as L,r as oe,u as W,v as J}from"./index.TDUkrpct.js";import{s as z,g as ce,f as F,N as fe}from"./Notifications.D6YP3E6W.js";import{e as q}from"./each.CoxpLaMQ.js";import{g as ue}from"./entry.DpfWPHTa.js";function R(i,e,s){const t=i.slice();return t[3]=e[s],t}function X(i){let e,s,t,n,l,r=q(i[0].message.split(`
`)),c=[];for(let a=0;a<r.length;a+=1)c[a]=Y(R(i,r,a));return{c(){e=w("li");for(let a=0;a<c.length;a+=1)c[a].c();this.h()},l(a){e=y(a,"LI",{"data-sender":!0,"data-date":!0,class:!0});var f=M(e);for(let o=0;o<c.length;o+=1)c[o].l(f);f.forEach(h),this.h()},h(){d(e,"data-sender",s=i[0].name),d(e,"data-date",t=G(i[0].date)),d(e,"class","svelte-k73pkk"),K(e,"me",i[1]===i[0].name)},m(a,f){C(a,e,f);for(let o=0;o<c.length;o+=1)c[o]&&c[o].m(e,null);l=!0},p(a,f){if(f&1){r=q(a[0].message.split(`
`));let o;for(o=0;o<r.length;o+=1){const g=R(a,r,o);c[o]?c[o].p(g,f):(c[o]=Y(g),c[o].c(),c[o].m(e,null))}for(;o<c.length;o+=1)c[o].d(1);c.length=r.length}(!l||f&1&&s!==(s=a[0].name))&&d(e,"data-sender",s),(!l||f&1&&t!==(t=G(a[0].date)))&&d(e,"data-date",t),(!l||f&3)&&K(e,"me",a[1]===a[0].name)},i(a){l||(a&&x(()=>{l&&(n||(n=j(e,z,{axis:"x",duration:300},!0)),n.run(1))}),l=!0)},o(a){a&&(n||(n=j(e,z,{axis:"x",duration:300},!1)),n.run(0)),l=!1},d(a){a&&h(e),$(c,a),a&&n&&n.end()}}}function Y(i){let e,s=i[3]+"",t;return{c(){e=w("div"),t=ee(s)},l(n){e=y(n,"DIV",{});var l=M(e);t=te(l,s),l.forEach(h)},m(n,l){C(n,e,l),v(e,t)},p(n,l){l&1&&s!==(s=n[3]+"")&&se(t,s)},d(n){n&&h(e)}}}function me(i){let e,s=i[0].message&&X(i);return{c(){s&&s.c(),e=O()},l(t){s&&s.l(t),e=O()},m(t,n){s&&s.m(t,n),C(t,e,n)},p(t,[n]){t[0].message?s?(s.p(t,n),n&1&&_(s,1)):(s=X(t),s.c(),_(s,1),s.m(e.parentNode,e)):s&&(V(),p(s,1,1,()=>{s=null}),B())},i(t){_(s)},o(t){p(s)},d(t){t&&h(e),s&&s.d(t)}}}function G(i){let e=new Date(i),s="0"+e.getMinutes();return e.getHours()+":"+s.substring(s.length-2)}function ge(i,e,s){let{data:t}=e,{myUsername:n=null}=e,l=n??sessionStorage.getItem("public_username");return i.$$set=r=>{"data"in r&&s(0,t=r.data),"myUsername"in r&&s(2,n=r.myUsername)},[t,l,n]}class ne extends N{constructor(e){super(),T(this,e,ge,me,U,{data:0,myUsername:2})}}function de(i){let e,s;return e=new ne({props:{data:i[1],myUsername:"@"+i[0]}}),{c(){D(e.$$.fragment)},l(t){I(e.$$.fragment,t)},m(t,n){S(e,t,n),s=!0},p(t,[n]){const l={};n&1&&(l.myUsername="@"+t[0]),e.$set(l)},i(t){s||(_(e.$$.fragment,t),s=!0)},o(t){p(e.$$.fragment,t),s=!1},d(t){E(e,t)}}}function he(i,e,s){let{data:t}=e,{myUsername:n}=e,l={message:t.message,name:"@"+t.username,chat:t.chat,date:t.date};return i.$$set=r=>{"data"in r&&s(2,t=r.data),"myUsername"in r&&s(0,n=r.myUsername)},[n,l,t]}class _e extends N{constructor(e){super(),T(this,e,he,de,U,{data:2,myUsername:0})}}function Q(i,e,s){const t=i.slice();return t[10]=e[s],t}function be(i){let e,s;return e=new _e({props:{data:i[10],myUsername:i[2].username}}),{c(){D(e.$$.fragment)},l(t){I(e.$$.fragment,t)},m(t,n){S(e,t,n),s=!0},p(t,n){const l={};n&1&&(l.data=t[10]),e.$set(l)},i(t){s||(_(e.$$.fragment,t),s=!0)},o(t){p(e.$$.fragment,t),s=!1},d(t){E(e,t)}}}function pe(i){let e,s;return e=new ne({props:{data:i[10]}}),{c(){D(e.$$.fragment)},l(t){I(e.$$.fragment,t)},m(t,n){S(e,t,n),s=!0},p(t,n){const l={};n&1&&(l.data=t[10]),e.$set(l)},i(t){s||(_(e.$$.fragment,t),s=!0)},o(t){p(e.$$.fragment,t),s=!1},d(t){E(e,t)}}}function Z(i){let e,s,t,n;const l=[pe,be],r=[];function c(a,f){return a[10].chat==="public"?0:1}return e=c(i),s=r[e]=l[e](i),{c(){s.c(),t=O()},l(a){s.l(a),t=O()},m(a,f){r[e].m(a,f),C(a,t,f),n=!0},p(a,f){let o=e;e=c(a),e===o?r[e].p(a,f):(V(),p(r[o],1,1,()=>{r[o]=null}),B(),s=r[e],s?s.p(a,f):(s=r[e]=l[e](a),s.c()),_(s,1),s.m(t.parentNode,t))},i(a){n||(_(s),n=!0)},o(a){p(s),n=!1},d(a){a&&h(t),r[e].d(a)}}}function ke(i){let e,s,t=q(i[0]),n=[];for(let r=0;r<t.length;r+=1)n[r]=Z(Q(i,t,r));const l=r=>p(n[r],1,1,()=>{n[r]=null});return{c(){e=w("ul");for(let r=0;r<n.length;r+=1)n[r].c();this.h()},l(r){e=y(r,"UL",{class:!0});var c=M(e);for(let a=0;a<n.length;a+=1)n[a].l(c);c.forEach(h),this.h()},h(){d(e,"class","svelte-lyrnl1")},m(r,c){C(r,e,c);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(e,null);i[7](e),s=!0},p(r,[c]){if(c&5){t=q(r[0]);let a;for(a=0;a<t.length;a+=1){const f=Q(r,t,a);n[a]?(n[a].p(f,c),_(n[a],1)):(n[a]=Z(f),n[a].c(),_(n[a],1),n[a].m(e,null))}for(V(),a=t.length;a<n.length;a+=1)l(a);B()}},i(r){if(!s){for(let c=0;c<t.length;c+=1)_(n[c]);s=!0}},o(r){n=n.filter(Boolean);for(let c=0;c<n.length;c+=1)p(n[c]);s=!1},d(r){r&&h(e),$(n,r),i[7](null)}}}function ve(i,e,s){let{websocket:t}=e,{chatType:n}=e,{chatID:l=null}=e,{previousMessages:r=null}=e,c=localStorage.getItem("user");!c&&n==="DM"&&ue("/login");let a=JSON.parse(c??"{}");r&&(r=r.filter(u=>u.sender==a.id&&u.recipient===l||u.recipient==a.id&&u.sender===l));let f=r??[];t.addEventListener("message",()=>{let u=sessionStorage.getItem("websocket.message");if(!u)return;const b=JSON.parse(u);if((b.statusCode===202||b.statusCode===206)&&b.data.chat===n){if(s(0,f=[...f,b.data]),n==="DM"&&b.statusCode===202){let k=JSON.parse(localStorage.getItem("dmMessages")??"[]");k.push(b.data),localStorage.setItem("dmMessages",JSON.stringify(k))}sessionStorage.removeItem("websocket.message")}});let o;const g=()=>{s(1,o.scrollTop=o.scrollHeight,o)};ae(()=>g()),re(()=>g());function m(u){le[u?"unshift":"push"](()=>{o=u,s(1,o)})}return i.$$set=u=>{"websocket"in u&&s(4,t=u.websocket),"chatType"in u&&s(5,n=u.chatType),"chatID"in u&&s(6,l=u.chatID),"previousMessages"in u&&s(3,r=u.previousMessages)},[f,o,a,r,t,n,l,m]}class we extends N{constructor(e){super(),T(this,e,ve,ke,U,{websocket:4,chatType:5,chatID:6,previousMessages:3})}}function ye(i){let e,s,t,n,l,r="Send",c,a;return{c(){e=w("div"),s=w("textarea"),n=A(),l=w("button"),l.textContent=r,this.h()},l(f){e=y(f,"DIV",{class:!0});var o=M(e);s=y(o,"TEXTAREA",{id:!0,placeholder:!0,class:!0}),M(s).forEach(h),n=L(o),l=y(o,"BUTTON",{id:!0,class:!0,"data-svelte-h":!0}),oe(l)!=="svelte-t4wonu"&&(l.textContent=r),o.forEach(h),this.h()},h(){s.disabled=t=!i[0],d(s,"id","public-message-input"),d(s,"placeholder","Type your message..."),d(s,"class","svelte-1gqjod5"),d(l,"id","public-send-button"),d(l,"class","svelte-1gqjod5"),d(e,"class","send-message svelte-1gqjod5")},m(f,o){C(f,e,o),v(e,s),W(s,i[1]),v(e,n),v(e,l),c||(a=[J(s,"input",i[6]),J(s,"keydown",i[3]),J(l,"click",i[2])],c=!0)},p(f,[o]){o&1&&t!==(t=!f[0])&&(s.disabled=t),o&2&&W(s,f[1])},i:H,o:H,d(f){f&&h(e),c=!1,ie(a)}}}function Me(i,e,s){let{websocket:t}=e,{chat:n}=e,{active:l}=e,r="";function c(){l&&r.trim()!==""&&(t.send(JSON.stringify({request:"sendMessage",content:{message:r,chat:n}})),s(1,r=""))}function a(o){o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),c())}function f(){r=this.value,s(1,r)}return i.$$set=o=>{"websocket"in o&&s(4,t=o.websocket),"chat"in o&&s(5,n=o.chat),"active"in o&&s(0,l=o.active)},[l,r,c,a,t,n,f]}class De extends N{constructor(e){super(),T(this,e,Me,ye,U,{websocket:4,chat:5,active:0})}}function Ie(i){let e,s,t,n,l,r,c,a,f,o,g;return r=new we({props:{websocket:i[0],chatType:i[5],chatID:i[2]!=="public"?parseInt(i[2].substring(1)):null,previousMessages:i[5]==="DM"?i[4]:null}}),f=new De({props:{websocket:i[0],chat:i[2],active:i[3]}}),{c(){e=w("div"),s=w("h1"),t=ee(i[1]),n=A(),l=w("div"),D(r.$$.fragment),c=A(),a=w("div"),D(f.$$.fragment),this.h()},l(m){e=y(m,"DIV",{class:!0});var u=M(e);s=y(u,"H1",{class:!0});var b=M(s);t=te(b,i[1]),b.forEach(h),n=L(u),l=y(u,"DIV",{class:!0});var k=M(l);I(r.$$.fragment,k),k.forEach(h),c=L(u),a=y(u,"DIV",{class:!0});var P=M(a);I(f.$$.fragment,P),P.forEach(h),u.forEach(h),this.h()},h(){d(s,"class","svelte-xjm7px"),d(l,"class","messages svelte-xjm7px"),d(a,"class","send-message svelte-xjm7px"),d(e,"class","wrapper svelte-xjm7px")},m(m,u){C(m,e,u),v(e,s),v(s,t),v(e,n),v(e,l),S(r,l,null),v(e,c),v(e,a),S(f,a,null),g=!0},p(m,[u]){(!g||u&2)&&se(t,m[1]);const b={};u&1&&(b.websocket=m[0]),u&4&&(b.chatID=m[2]!=="public"?parseInt(m[2].substring(1)):null),r.$set(b);const k={};u&1&&(k.websocket=m[0]),u&4&&(k.chat=m[2]),u&8&&(k.active=m[3]),f.$set(k)},i(m){g||(_(r.$$.fragment,m),_(f.$$.fragment,m),m&&x(()=>{g&&(o||(o=j(e,F,{},!0)),o.run(1))}),g=!0)},o(m){p(r.$$.fragment,m),p(f.$$.fragment,m),m&&(o||(o=j(e,F,{},!1)),o.run(0)),g=!1},d(m){m&&h(e),E(r),E(f),m&&o&&o.end()}}}function Se(i,e,s){let{title:t}=e,{chat:n}=e,{websocket:l}=e,r=JSON.parse(localStorage.getItem("dmMessages")??"[]");const{addNotification:c}=ce();let a=n=="public"?n:"DM",f=!1;function o(){console.log(`Connected successfully to "${t}".`),s(3,f=!0),c({text:"Connected",type:"success",position:"bottom-right",removeAfter:3e3})}return l.readyState===WebSocket.OPEN?o():l.addEventListener("open",o),l.onerror=()=>{console.log(`There was an error connecting to "${t}".`),s(3,f=!1),c({text:"Connection Error",type:"error",position:"bottom-right",removeAfter:3e3})},l.onclose=()=>{console.log(`You've been disconnected from "${t}".`),s(3,f=!1),c({text:"Disconnected",type:"warning",position:"bottom-right",removeAfter:2e3})},i.$$set=g=>{"title"in g&&s(1,t=g.title),"chat"in g&&s(2,n=g.chat),"websocket"in g&&s(0,l=g.websocket)},[l,t,n,f,r,a]}class Ee extends N{constructor(e){super(),T(this,e,Se,Ie,U,{title:1,chat:2,websocket:0})}}function Ce(i){let e,s;return e=new Ee({props:{title:i[0],chat:i[1],websocket:i[2]}}),{c(){D(e.$$.fragment)},l(t){I(e.$$.fragment,t)},m(t,n){S(e,t,n),s=!0},p(t,n){const l={};n&1&&(l.title=t[0]),n&2&&(l.chat=t[1]),n&4&&(l.websocket=t[2]),e.$set(l)},i(t){s||(_(e.$$.fragment,t),s=!0)},o(t){p(e.$$.fragment,t),s=!1},d(t){E(e,t)}}}function Ue(i){let e,s;return e=new fe({props:{$$slots:{default:[Ce]},$$scope:{ctx:i}}}),{c(){D(e.$$.fragment)},l(t){I(e.$$.fragment,t)},m(t,n){S(e,t,n),s=!0},p(t,[n]){const l={};n&15&&(l.$$scope={dirty:n,ctx:t}),e.$set(l)},i(t){s||(_(e.$$.fragment,t),s=!0)},o(t){p(e.$$.fragment,t),s=!1},d(t){E(e,t)}}}function Ne(i,e,s){let{title:t}=e,{chat:n}=e,{websocket:l}=e;return i.$$set=r=>{"title"in r&&s(0,t=r.title),"chat"in r&&s(1,n=r.chat),"websocket"in r&&s(2,l=r.websocket)},[t,n,l]}class Ae extends N{constructor(e){super(),T(this,e,Ne,Ue,U,{title:0,chat:1,websocket:2})}}export{Ae as C};
