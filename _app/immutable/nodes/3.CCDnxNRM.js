import{s as O,n as y,c as z}from"../chunks/scheduler.DbuCXXLn.js";import{S as J,i as q,e as v,f as I,s as M,g as p,h as b,j as D,k as d,l as P,q as _,n as x,o as h,p as L,z as R,b as N,x as T,t as E,r as V,C as K,c as W,a as B,m as G,d as F}from"../chunks/index.TDUkrpct.js";import{e as A}from"../chunks/each.CoxpLaMQ.js";import{g as Q,d as X,w as Y}from"../chunks/entry.DpfWPHTa.js";function Z(i){let e,a,s,r,o,n,l,t=i[0].message+"",u,k,S=U(i[0].date)+"",w,C;return{c(){e=v("a"),a=v("li"),s=v("strong"),r=I("@"),o=I(i[2]),n=I(":"),l=M(),u=I(t),k=I(" - "),w=I(S),this.h()},l(c){e=p(c,"A",{href:!0,class:!0});var f=b(e);a=p(f,"LI",{class:!0});var m=b(a);s=p(m,"STRONG",{});var g=b(s);r=D(g,"@"),o=D(g,i[2]),n=D(g,":"),g.forEach(d),l=P(m),u=D(m,t),k=D(m," - "),w=D(m,S),m.forEach(d),f.forEach(d),this.h()},h(){_(a,"class","svelte-xhccac"),_(e,"href",C="/dm/"+i[1]),_(e,"class","svelte-xhccac")},m(c,f){x(c,e,f),h(e,a),h(a,s),h(s,r),h(s,o),h(s,n),h(a,l),h(a,u),h(a,k),h(a,w)},p(c,[f]){f&4&&L(o,c[2]),f&1&&t!==(t=c[0].message+"")&&L(u,t),f&1&&S!==(S=U(c[0].date)+"")&&L(w,S),f&2&&C!==(C="/dm/"+c[1])&&_(e,"href",C)},i:y,o:y,d(c){c&&d(e)}}}function U(i){const e=new Date(i);return`${e.toLocaleDateString()} ${e.toLocaleTimeString()}`}function ee(i,e,a){let{userID:s}=e,{data:r}=e,o,n;return s===r.recipient?(o=r.sender,n=r.username):(o=r.recipient,n=r.recipientUsername),i.$$set=l=>{"userID"in l&&a(3,s=l.userID),"data"in l&&a(0,r=l.data)},[r,o,n,s]}class te extends J{constructor(e){super(),q(this,e,ee,Z,O,{userID:3,data:0})}}function j(i,e,a){const s=i.slice();return s[11]=e[a],s}function se(i){let e,a,s="No chats where found",r,o,n;return{c(){e=v("div"),a=v("h3"),a.textContent=s,r=M(),o=v("a"),n=I("Click here to Start a Conversation"),this.h()},l(l){e=p(l,"DIV",{class:!0});var t=b(e);a=p(t,"H3",{"data-svelte-h":!0}),V(a)!=="svelte-odx5oj"&&(a.textContent=s),r=P(t),o=p(t,"A",{href:!0,class:!0});var u=b(o);n=D(u,"Click here to Start a Conversation"),u.forEach(d),t.forEach(d),this.h()},h(){_(o,"href","/dm/"+(i[3]-1)),_(o,"class","svelte-15vy0k4"),_(e,"class","not-found svelte-15vy0k4")},m(l,t){x(l,e,t),h(e,a),h(e,r),h(e,o),h(o,n)},p:y,i:y,o:y,d(l){l&&d(e)}}}function ae(i){let e,a,s=A(i[1].slice().reverse()),r=[];for(let n=0;n<s.length;n+=1)r[n]=H(j(i,s,n));const o=n=>N(r[n],1,1,()=>{r[n]=null});return{c(){e=v("ul");for(let n=0;n<r.length;n+=1)r[n].c();this.h()},l(n){e=p(n,"UL",{class:!0});var l=b(e);for(let t=0;t<r.length;t+=1)r[t].l(l);l.forEach(d),this.h()},h(){_(e,"class","svelte-15vy0k4")},m(n,l){x(n,e,l);for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,null);a=!0},p(n,l){if(l&10){s=A(n[1].slice().reverse());let t;for(t=0;t<s.length;t+=1){const u=j(n,s,t);r[t]?(r[t].p(u,l),E(r[t],1)):(r[t]=H(u),r[t].c(),E(r[t],1),r[t].m(e,null))}for(R(),t=s.length;t<r.length;t+=1)o(t);T()}},i(n){if(!a){for(let l=0;l<s.length;l+=1)E(r[l]);a=!0}},o(n){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)N(r[l]);a=!1},d(n){n&&d(e),K(r,n)}}}function H(i){let e,a;return e=new te({props:{userID:i[3],data:i[11]}}),{c(){W(e.$$.fragment)},l(s){B(e.$$.fragment,s)},m(s,r){G(e,s,r),a=!0},p(s,r){const o={};r&2&&(o.data=s[11]),e.$set(o)},i(s){a||(E(e.$$.fragment,s),a=!0)},o(s){N(e.$$.fragment,s),a=!1},d(s){F(e,s)}}}function re(i){let e,a,s,r;const o=[ae,se],n=[];function l(t,u){return t[0].length>0?0:1}return a=l(i),s=n[a]=o[a](i),{c(){e=v("div"),s.c(),this.h()},l(t){e=p(t,"DIV",{class:!0});var u=b(e);s.l(u),u.forEach(d),this.h()},h(){_(e,"class","svelte-15vy0k4")},m(t,u){x(t,e,u),n[a].m(e,null),r=!0},p(t,[u]){let k=a;a=l(t),a===k?n[a].p(t,u):(R(),N(n[k],1,1,()=>{n[k]=null}),T(),s=n[a],s?s.p(t,u):(s=n[a]=o[a](t),s.c()),E(s,1),s.m(e,null))},i(t){r||(E(s),r=!0)},o(t){N(s),r=!1},d(t){t&&d(e),n[a].d()}}}function ne(i,e,a){let s,r,{websocket:o}=e;const n=Y([]);z(i,n,c=>a(0,s=c));let l=JSON.parse(localStorage.getItem("dmMessages")??"[]"),t=null;l&&(t=l.length===0?null:l.reduce((c,f)=>f.id>c.id?f:c).id,n.update(c=>[...c,...l]));const u=localStorage.getItem("user");u||Q("/login");let S=JSON.parse(u??"").id;const w=X(n,c=>c.filter((f,m,g)=>g.findLastIndex($=>$.sender===f.sender&&$.recipient===f.recipient||$.sender===f.recipient&&$.recipient===f.sender)===m));z(i,w,c=>a(1,r=c)),o.addEventListener("message",c=>{let f=sessionStorage.getItem("websocket.message");if(!f)return;let m=JSON.parse(f);m.statusCode===206&&(n.update(g=>[...g,...m.data.messages]),n.subscribe(g=>{localStorage.setItem("dmMessages",JSON.stringify(g))}))});function C(){o.send(JSON.stringify({request:"getChats",data:t}))}return o.readyState===WebSocket.OPEN?C():o.addEventListener("open",C),i.$$set=c=>{"websocket"in c&&a(5,o=c.websocket)},[s,r,n,S,w,o]}class le extends J{constructor(e){super(),q(this,e,ne,re,O,{websocket:5})}}function oe(i){let e,a,s="Private Chats",r,o,n;return o=new le({props:{websocket:i[0]}}),{c(){e=v("main"),a=v("h1"),a.textContent=s,r=M(),W(o.$$.fragment),this.h()},l(l){e=p(l,"MAIN",{class:!0});var t=b(e);a=p(t,"H1",{class:!0,"data-svelte-h":!0}),V(a)!=="svelte-xwcw0e"&&(a.textContent=s),r=P(t),B(o.$$.fragment,t),t.forEach(d),this.h()},h(){_(a,"class","svelte-i79wnz"),_(e,"class","svelte-i79wnz")},m(l,t){x(l,e,t),h(e,a),h(e,r),G(o,e,null),n=!0},p:y,i(l){n||(E(o.$$.fragment,l),n=!0)},o(l){N(o.$$.fragment,l),n=!1},d(l){l&&d(e),F(o)}}}function ie(i,e,a){let{data:s}=e,r=s.websocket;return i.$$set=o=>{"data"in o&&a(1,s=o.data)},[r,s]}class de extends J{constructor(e){super(),q(this,e,ie,oe,O,{data:1})}}export{de as component};
